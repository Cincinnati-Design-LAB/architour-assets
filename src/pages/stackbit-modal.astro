---
import Layout from "@layouts/Layout.astro";
import { getPaginatedImages } from "@content/utils/get-images";

const imagePages = await getPaginatedImages();

const images = imagePages[0].images;
---

<Layout title="Stackbit Modal">
  <main class="p-4">
    <div class="grid grid-cols-4 gap-4" data-clearyst-images>
      {
        images.map((image) => {
          return (
            <div class="overflow-hidden hover:cursor-pointer border-4 border-transparent hover:border-blue-300 transition-all duration-300">
              <img
                src={image.thumbUrl}
                class="width-full transition-all duration-300 hover:scale-110"
              />
            </div>
          );
        })
      }
    </div>
  </main>
</Layout>

<script>
  const images = document.querySelectorAll("[data-clearyst-images] img");

  // Listen for clicks on images and send `postMessage`
  images.forEach((image) => {
    image.addEventListener("click", function () {
      console.log("Clicked image", this.src);
      if (window.parent) {
        window.parent.postMessage(
          {
            type: "clearyst-cloudinary-assets",
            imageUrl: this.src,
          },
          "*"
        );
      }
    });
  });
</script>
